<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
<?php
    include 'connect.php';
    $sql = "CALL Load_All_department"; // SQL query to select data from the table
    $result = $conn->query($sql); // Execute the query

    if ($result->num_rows > 0) {
        while ($row = $result->fetch_assoc()) {
            // Output data row by row
            echo "<tr>
                    <td class='d-flex justify-content-between border' name='" . $row["department_name"] . "' id='" . $row["department_pk"] . "'>" . $row["department_name"] . "
                    <button 
                        type='button'
                        id = '" . $row["department_pk"] . "'
                        data-department-name='" . $row["department_name"] . "' 
                        data-department-pk='" . $row["department_pk"] . "' 
                        class='btn btn-primary plus-btn fw-bolder' 
                        data-bs-toggle='modal' 
                        data-bs-target='#exampleModal'>
                        +
                    </button>
                    </td>
                  </tr>";
        }
    } else {
        echo "<tr><td colspan='1'>0 results</td></tr>"; // Output if no results found
    }
    $conn->close(); // Close the database connection
?>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function(){
            $("button").click(function(){
                var button_id = $(this).attr('id'); // Get the ID of the clicked button
                $.ajax({
                    url: 'create-user.php', // PHP script to handle the button click
                    type: 'POST',
                    data: {button_id: button_id}, // Send the button ID to the PHP script
                    success: function(response) {
                        alert(response); // Display the response from the PHP script
                    }
                });
            });
        });
    </script>
</html>



<!-- scrpt in html (create-user.php) -->
 <!-- Modal -->
 <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method='POST' action="code.php">
                <?php
                  if(isset($_POST['button_id'])) {
                      $button_id = $_POST['button_id'];
                      echo "Button with ID '$button_id' was clicked!";
                  }
              ?>
                <?php
                include 'connect.php';

                $departmentPk = '9';
                // Query to fetch checked department names from the database
                $checked_values_query = "SELECT product_tran_name_str,department_fk FROM tblproductadjustpermission where department_fk = $departmentPk";
                $checked_values_result = $conn->query($checked_values_query);

                // Initialize $checked_values array
                $checked_values = array();

                // Check if the query was successful and rows were returned
                if ($checked_values_result && $checked_values_result->num_rows > 0) {
                    // Loop through the fetched rows and populate $checked_values array
                    while ($row = $checked_values_result->fetch_assoc()) {
                        $checked_values[] = $row['product_tran_name_str'];
                    }
                }

                $sql = "CALL Load_All_Transaction"; 
                $result = $conn->query($sql); // Execute the query

                if ($result && $result->num_rows > 0) {
                    // Output the hidden input field for department_pk
                    echo "<input type='hidden' name='department_pk' id='department_pk_input' value='department_pk'>";

                    // Loop through your checkboxes and output them
                    while ($row = $result->fetch_assoc()) {
                        $checkbox_value = $row["department_name"];
                        $checked = in_array($checkbox_value, $checked_values) ? 'checked' : ''; // Check if the checkbox value exists in the checked values array

                        echo "<div class='form-group mb-3 d-flex justify-content-between'>
                                  <label>$checkbox_value</label>
                                  <input class='form-check-input' type='checkbox' name='brands[]' value='$checkbox_value' $checked>
                              </div>";
                    }
                } else {
                    echo "<label>No results found</label>"; // Output if no results found
                }
                ?>

                            <div class='form-group mb-3 d-flex justify-content-end'>
                                <button type='button' class='btn btn-secondary mx-2' data-bs-dismiss='modal'>Close</button>
                                <button type='submit' name='save_multiple_checkbox' class='btn btn-primary'>Submit</button>
                            </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    document.querySelectorAll('.plus-btn').forEach(button => {
      button.addEventListener('click', function () {
        var departmentName = this.getAttribute('data-department-name');
        var modalTitle = document.querySelector('#exampleModal .modal-title');
        modalTitle.textContent = departmentName;
        modalTitle.id = ""; // Clear the ID first
        modalTitle.id = this.parentNode.id; // Set the ID based on the department ID
      });
    });
  </script>
  <script>
    $(document).ready(function () {
      $('#exampleModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);
        var department_pk = button.data('department-pk');
        var modal = $(this);
        modal.find('#department_pk_input').val(department_pk);
      });
    });
  </script>









<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/create-user.css">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <title>Document</title>
</head>
<body>
<?php
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "inventorymanagement";

// Create connection
$conn = new mysqli($servername, $username, $password, $dbname);

// Check connection 
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

$sql = "CALL Load_All_department"; // SQL query to select data from the departments table
$result = $conn->query($sql);

if ($result->num_rows > 0) {
    // Output data of each row
    while($row = $result->fetch_assoc()) {
        $department_pk = $row["department_pk"];
        $department_name = $row["department_name"];
        echo "<tr>
                    <td class='d-flex justify-content-between border' name='$department_name' id='$department_pk'>$department_name
                    <button type='button' id='$department_pk' class='btn btn-primary'>+</button>
                    </td>
                  </tr>";
    }
} else {
    echo "0 results";
}
$conn->close();
?>
<!-- Modal -->
<div id="myModal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
        <span class="close">&times;</span>
        <div id="modal-content"></div>
    </div>
</div>
</body>
<script>
        $(document).ready(function(){
            $("button").click(function(){
                var button_id = $(this).attr('id'); // Get the ID of the clicked button
                $.ajax({
                    url: 'process.php', // PHP script to handle the button click
                    type: 'POST',
                    data: {button_id: button_id}, // Send the button ID to the PHP script
                    success: function(response) {
                        // Display the response from the PHP script in the modal
                        $('#modal-content').html(response);
                        $('#myModal').css('display', 'block');
                    }
                });
            });

            // Close the modal when the close button is clicked
            $(".close").click(function() {
                $('#myModal').css('display', 'none');
            });

            // Close the modal when the user clicks outside of it
            $(window).click(function(event) {
                if (event.target.id === 'myModal') {
                    $('#myModal').css('display', 'none');
                }
            });
        });
    </script>
</html>